<!DOCTYPE html>
<html lang="id" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>FikXzMods Panel</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Phosphor Icons CDN -->
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <!-- SweetAlert2 CDN for beautiful alerts -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Inter Font from Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <script>
    // Tailwind CSS Configuration with extended colors and dark mode setup
    tailwind.config = {
      darkMode: 'class', // Enable dark mode using 'class' strategy
      theme: {
        extend: {
          colors: {
            'bg-dark': '#020617', // Dark background
            'card-dark': '#0f172a', // Darker card background
            'text-light': '#f1f5f9', // Light text for dark mode
            'muted-text': '#94a3b8', // Muted text color
            'border-dark': '#1e293b', // Dark border color
            'accent-blue': '#3b82f6', // Accent blue color
            'accent-blue-hover': '#2563eb', // Darker accent blue on hover
            'success-green': '#10b981', // Success green
            'success-green-hover': '#059669', // Darker success green on hover
            'warning-yellow': '#eab308', // Warning yellow
            'warning-yellow-hover': '#d97706', // Darker warning yellow on hover
            'danger-red': '#ef4444', // Danger red
            'danger-red-hover': '#dc2626', // Darker danger red on hover
            'info-purple': '#8b5cf6', // Info purple
            'info-purple-hover': '#7c3aed' // Darker info purple on hover
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out',
            'fade-out': 'fadeOut 0.3s ease-out forwards', // Added fade-out for smoother transitions
            'slide-in-right': 'slideInRight 0.3s ease-out',
            'slide-out-right': 'slideOutRight 0.3s ease-out forwards',
            'spin-slow': 'spin 3s linear infinite',
            'bounce-subtle': 'bounce 1s infinite',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            fadeOut: { // New keyframe for fading out
              '0%': { opacity: '1' },
              '100%': { opacity: '0' },
            },
            slideInRight: {
              '0%': { transform: 'translateX(100%)' },
              '100%': { transform: 'translateX(0)' },
            },
            slideOutRight: {
              '0%': { transform: 'translateX(0)' },
              '100%': { transform: 'translateX(100%)' },
            },
            bounce: {
              '0%, 100%': { transform: 'translateY(-5%)', animationTimingFunction: 'cubic-bezier(0.8,0,1,1)' },
              '50%': { transform: 'none', animationTimingFunction: 'cubic-bezier(0,0,0.2,1)' },
            },
          }
        }
      }
    }
  </script>
  <style>
    /* Custom CSS for body background and general transitions */
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to bottom, #0f172a 0%, #1e293b 100%);
      min-height: 100vh; /* Ensure body takes full viewport height */
      display: flex;
      flex-direction: column;
    }

    /* Sidebar transition */
    #sidebar {
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Style for iframe to ensure it's responsive */
    #previewIframe {
      border: none;
      width: 100%;
      height: 100%;
      min-height: 400px; /* Minimum height for preview iframe */
    }

    /* Custom scrollbar for better aesthetics */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #0f172a;
    }

    ::-webkit-scrollbar-thumb {
      background: #3b82f6;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #2563eb;
    }

    /* Custom file input styling */
    input[type="file"]::file-selector-button {
      background-color: var(--tw-bg-accent-blue);
      color: white;
      border: none;
      padding: 0.75rem 1rem; /* Equivalent to py-3 px-4 */
      border-radius: 9999px; /* Equivalent to rounded-full */
      margin-right: 1rem; /* Equivalent to mr-4 */
      font-size: 0.875rem; /* Equivalent to text-sm */
      font-weight: 600; /* Equivalent to font-semibold */
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
    }

    input[type="file"]::file-selector-button:hover {
      background-color: var(--tw-bg-accent-blue-hover);
    }

    /* This allows the custom file input button to work correctly with Tailwind classes */
    input[type="file"].custom-file-input {
      @apply cursor-pointer; /* Ensure cursor is pointer for the whole input */
    }
  </style>
</head>
<body class="dark bg-bg-dark text-text-light overflow-x-hidden">
  <!-- Mobile Sidebar Toggle Button -->
  <div class="fixed top-4 right-4 z-50 md:hidden">
    <button onclick="toggleSidebar()" class="p-3 rounded-xl border border-accent-blue text-accent-blue text-xl bg-card-dark shadow-lg hover:shadow-xl hover:scale-105 transform transition-all duration-200">
      <i class="ph ph-list"></i>
    </button>
  </div>

  <!-- Sidebar / Navigation -->
  <div id="sidebar" class="fixed top-0 right-0 h-full w-64 bg-card-dark border-l border-border-dark shadow-2xl transform translate-x-full z-50 flex flex-col md:static md:w-auto md:h-auto md:border-none md:shadow-none md:flex-row md:items-center md:justify-end md:transform-none md:bg-transparent md:p-0 md:pr-6">
    <div class="flex justify-between items-center px-4 py-4 border-b border-border-dark md:hidden">
      <h2 class="font-bold text-lg text-text-light">Menu</h2>
      <button onclick="toggleSidebar()" class="text-text-light text-2xl hover:text-accent-blue transform hover:rotate-90 transition-all duration-300"><i class="ph ph-x"></i></button>
    </div>
    <nav class="flex flex-col md:flex-row md:space-x-4">
      <button onclick="showSection('generate'); toggleSidebar();" class="text-left px-6 py-4 text-text-light hover:bg-accent-blue hover:text-white rounded-md transition-colors duration-200 md:px-3 md:py-2">
        <i class="ph ph-code inline-block mr-2"></i> Buat HTML
      </button>
      <button onclick="showSection('encode'); toggleSidebar();" class="text-left px-6 py-4 text-text-light hover:bg-accent-blue hover:text-white rounded-md transition-colors duration-200 md:px-3 md:py-2">
        <i class="ph ph-lock-key inline-block mr-2"></i> Enkripsi JS Hard
      </button>
      <button onclick="showSection('deploy'); toggleSidebar();" class="text-left px-6 py-4 text-text-light hover:bg-accent-blue hover:text-white rounded-md transition-colors duration-200 md:px-3 md:py-2">
        <i class="ph ph-rocket inline-block mr-2"></i> Deploy HTML
      </button>
    </nav>
  </div>

  <!-- Main Content Area -->
  <main class="p-6 max-w-6xl mx-auto w-full flex-grow space-y-12 animate-fade-in">
    <!-- HTML Generator Section -->
    <section id="generate" class="space-y-6 bg-card-dark p-8 rounded-xl shadow-2xl border border-border-dark">
      <h1 class="text-3xl font-extrabold text-accent-blue flex items-center">
        <i class="ph ph-code-block mr-3"></i> Generator HTML
      </h1>
      <textarea id="prompt" rows="5" placeholder="Contoh: Website portofolio modern dengan dark mode, bagian 'Tentang Saya', dan galeri gambar."
        class="w-full p-4 rounded-lg bg-bg-dark border border-border-dark text-text-light focus:ring-2 focus:ring-accent-blue outline-none transition-all duration-200 resize-y"></textarea>
      <button onclick="generateHTML()" class="w-full md:w-auto bg-accent-blue hover:bg-accent-blue-hover text-white font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-center">
        <i class="ph ph-magic-wand mr-2"></i> Generate HTML
      </button>
      <div id="result" class="w-full text-sm mt-4 p-4 bg-bg-dark rounded-xl border border-border-dark hidden flex-col items-center justify-center">
        <div id="loadingIndicator" class="hidden flex flex-col items-center justify-center py-8">
          <i class="ph ph-spinner text-4xl text-accent-blue animate-spin-slow"></i>
          <p class="text-muted-text mt-3">Sedang membuat HTML...</p>
        </div>
        <div id="resultContent" class="hidden w-full">
          <h2 class='text-xl font-bold text-success-green mb-4 text-center'>
            <i class="ph ph-check-circle inline-block mr-2"></i> HTML Siap Digunakan!
          </h2>
          <div class='flex flex-wrap gap-3 my-3 justify-center'>
            <button onclick="downloadFile(document.getElementById('result').dataset.filename, document.getElementById('sourceBox').value)"
              class='bg-success-green hover:bg-success-green-hover text-white px-5 py-2 rounded-full shadow-md transform hover:scale-105 transition-all duration-200 flex items-center'>
              <i class="ph ph-download-simple mr-2"></i> Unduh
            </button>
            <button onclick="togglePreview(document.getElementById('sourceBox').value)"
              class='bg-info-purple hover:bg-info-purple-hover text-white px-5 py-2 rounded-full shadow-md transform hover:scale-105 transition-all duration-200 flex items-center'>
              <i class="ph ph-eye mr-2"></i> Pratinjau
            </button>
            <button onclick="toggleSource(document.getElementById('sourceBox').value)"
              class='bg-warning-yellow hover:bg-warning-yellow-hover text-white px-5 py-2 rounded-full shadow-md transform hover:scale-105 transition-all duration-200 flex items-center'>
              <i class="ph ph-code mr-2"></i> Kode Sumber
            </button>
            <button onclick="copyCode(document.getElementById('sourceBox').value)"
              class='bg-muted-text hover:bg-slate-600 text-white px-5 py-2 rounded-full shadow-md transform hover:scale-105 transition-all duration-200 flex items-center'>
              <i class="ph ph-copy-simple mr-2"></i> Salin
            </button>
          </div>
          <div id='previewBox' class='hidden w-full h-[500px] bg-white rounded-lg overflow-hidden shadow-inner border border-border-dark mt-4'>
            <iframe id='previewIframe'></iframe>
          </div>
          <textarea id='sourceBox' readonly
            class='hidden w-full h-80 bg-black text-green-400 p-3 rounded-lg font-mono text-xs overflow-auto border border-border-dark mt-4'></textarea>
        </div>
      </div>
    </section>

    <!-- Encode Hard JS Section -->
    <section id="encode" class="hidden space-y-6 bg-card-dark p-8 rounded-xl shadow-2xl border border-border-dark">
      <h1 class="text-3xl font-extrabold text-info-purple flex items-center justify-center">
        <i class="ph ph-lock-key mr-3"></i> Enkriptor JS hard FikXzMods
      </h1>
      <div>
        <label class="block font-semibold mb-2 text-text-light">
          <i class="ph ph-folder-open inline-block mr-2"></i> Unggah File JavaScript
        </label>
        <input type="file" id="fileInput" accept=".js"
          class="w-full p-3 rounded-md bg-bg-dark text-text-light border border-border-dark focus:ring-2 focus:ring-info-purple outline-none custom-file-input">
      </div>
      <div class="flex flex-col sm:flex-row gap-4">
        <button onclick="encodeHard()"
          class="flex-1 py-3 px-4 bg-info-purple text-white rounded-full hover:bg-info-purple-hover font-semibold shadow-md transform hover:scale-105 transition-all duration-200 flex items-center justify-center">
          <i class="ph ph-encrypt inline-block mr-2"></i> Enkripsi hard
        </button>
        <button onclick="downloadOutput()"
          class="flex-1 py-3 px-4 bg-success-green text-white rounded-full hover:bg-success-green-hover font-semibold shadow-md transform hover:scale-105 transition-all duration-200 flex items-center justify-center">
          <i class="ph ph-download-simple inline-block mr-2"></i> Unduh .js
        </button>
      </div>
    </section>

    <!-- Deploy HTML Section -->
    <section id="deploy" class="hidden space-y-8 bg-card-dark p-8 rounded-xl shadow-2xl border border-border-dark">
      <h1 class="text-3xl font-extrabold text-danger-red flex items-center justify-center mb-6">
        <i class="ph ph-rocket mr-3"></i> Deploy HTML
      </h1>
      <div class="space-y-4">
        <input id="projectName" type="text" placeholder="Nama Proyek (Contoh: situs-saya-keren)"
          class="w-full p-3 rounded-lg bg-bg-dark border border-border-dark text-text-light focus:ring-2 focus:ring-danger-red outline-none transition-all duration-200" />
        <input id="htmlFile" type="file" accept=".html"
          class="w-full p-3 rounded-lg bg-bg-dark border border-border-dark text-text-light focus:ring-2 focus:ring-danger-red outline-none custom-file-input" />
        <button onclick="deployHTML()"
          class="w-full bg-danger-red hover:bg-danger-red-hover text-white py-3 rounded-full font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-center">
          <i class="ph ph-cloud-arrow-up mr-2"></i> Deploy Proyek
        </button>
        <div id="deployActions" class="flex flex-col sm:flex-row gap-3 mt-4 hidden animate-fade-in">
          <button onclick="copyLink()"
            class="flex-1 bg-muted-text hover:bg-slate-600 text-white py-3 rounded-full shadow-md transform hover:scale-105 transition-all duration-200 flex items-center justify-center">
            <i class="ph ph-copy-simple mr-2"></i> Salin Tautan
          </button>
          <button onclick="viewSite()"
            class="flex-1 bg-info-purple hover:bg-info-purple-hover text-white py-3 rounded-full shadow-md transform hover:scale-105 transition-all duration-200 flex items-center justify-center">
            <i class="ph ph-globe mr-2"></i> Lihat Situs
          </button>
        </div>
      </div>

      <div class="bg-card-dark p-6 rounded-xl border border-border-dark shadow-lg">
        <h2 class="text-xl font-semibold mb-4 text-accent-blue flex items-center">
          <i class="ph ph-list-bullets mr-2"></i> Daftar Proyek Anda
        </h2>
        <button onclick="listProjects()"
          class="w-full bg-accent-blue hover:bg-accent-blue-hover text-white py-3 rounded-full font-bold mb-4 shadow-md transform hover:scale-105 transition-all duration-200 flex items-center justify-center">
          <i class="ph ph-folder-notch-open mr-2"></i> Tampilkan Proyek
        </button>
        <div id="projectListLoading" class="hidden flex flex-col items-center justify-center py-4">
          <i class="ph ph-spinner text-3xl text-accent-blue animate-spin-slow"></i>
          <p class="text-muted-text mt-2">Memuat daftar proyek...</p>
        </div>
        <div id="projectList" class="text-sm space-y-3 text-muted-text max-h-80 overflow-y-auto pr-2">
          <!-- Project list will be populated here -->
          <p class="text-center text-muted-text">Tekan 'Tampilkan Proyek' untuk melihat daftar.</p>
        </div>
      </div>

      <div class="bg-card-dark p-6 rounded-xl border border-border-dark shadow-lg">
        <h2 class="text-xl font-semibold mb-4 text-danger-red flex items-center">
          <i class="ph ph-trash mr-2"></i> Hapus Proyek
        </h2>
        <input id="deleteName" type="text" placeholder="Nama Proyek yang akan dihapus"
          class="w-full p-3 rounded-lg bg-bg-dark border border-border-dark text-text-light focus:ring-2 focus:ring-danger-red outline-none transition-all duration-200 mb-4" />
        <button onclick="deleteProject()"
          class="w-full bg-danger-red hover:bg-danger-red-hover text-white py-3 rounded-full font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center justify-center">
          <i class="ph ph-x-circle mr-2"></i> Hapus Proyek
        </button>
        <div id="message" class="text-sm text-center mt-4 p-3 rounded-lg hidden"></div>
      </div>
    </section>
  </main>

  <script>
    const vercelToken = "";
    const adminIP = ''; 
    let lastEncodedCode = "";
    let lastDeployedURL = "";

    // --- Utility Functions for UI/UX ---

    /**
     * Toggles the visibility of the sidebar.
     * Uses Tailwind's transform classes for slide-in/slide-out effect.
     */
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const isVisible = sidebar.classList.contains('translate-x-0');

      if (isVisible) {
        sidebar.classList.remove('animate-slide-in-right');
        sidebar.classList.add('animate-slide-out-right');
        setTimeout(() => {
          sidebar.classList.add('translate-x-full');
          sidebar.classList.remove('translate-x-0');
          sidebar.classList.remove('animate-slide-out-right');
        }, 300);
      } else {
        sidebar.classList.remove('translate-x-full');
        sidebar.classList.add('translate-x-0', 'animate-slide-in-right');
      }
    }

    /**
     * Shows a specific section and hides all others.
     * Adds a fade-in animation to the newly shown section.
     * @param {string} id - The ID of the section to show.
     */
    function showSection(id) {
      document.querySelectorAll('main > section').forEach(s => {
        // Apply fade-out before hiding to create a smoother transition between sections
        if (!s.classList.contains('hidden')) {
            s.classList.remove('animate-fade-in');
            s.classList.add('animate-fade-out');
            setTimeout(() => {
                s.classList.add('hidden');
                s.classList.remove('animate-fade-out'); // Clean up after animation
            }, 300); // Match fade-out duration
        } else {
            s.classList.add('hidden'); // Ensure all others are hidden
        }
      });

      const sectionToShow = document.getElementById(id);
      if (sectionToShow) {
        // Delay showing and animating to allow fade-out to complete for other sections
        setTimeout(() => {
            sectionToShow.classList.remove('hidden');
            void sectionToShow.offsetWidth; // Trigger reflow for animation
            sectionToShow.classList.add('animate-fade-in');
        }, 300); // Match fade-out duration
      }
    }

    /**
     * Displays a success SweetAlert2 notification.
     * @param {string} message - The message to display.
     */
    function swalSuccess(message) {
      Swal.fire({
        icon: "success",
        title: "Berhasil!",
        text: message,
        timer: 2500,
        showConfirmButton: false,
        toast: true,
        position: 'top-end',
        background: '#10b981', // Success green
        color: '#fff',
        timerProgressBar: true
      });
    }

    /**
     * Displays an error SweetAlert2 notification.
     * @param {string} message - The message to display.
     */
    function swalError(message) {
      Swal.fire({
        icon: "error",
        title: "Oops!",
        text: message,
        timer: 3000,
        showConfirmButton: false,
        toast: true,
        position: 'top-end',
        background: '#ef4444', // Danger red
        color: '#fff',
        timerProgressBar: true
      });
    }

    /**
     * Displays a loading SweetAlert2 notification.
     * @param {string} message - The message to display.
     * @returns {object} The Swal instance, allowing it to be closed later.
     */
    function swalLoading(message) {
      return Swal.fire({
        title: message,
        allowOutsideClick: false,
        showConfirmButton: false,
        willOpen: () => {
          Swal.showLoading();
        },
        background: '#0f172a', // Card dark
        color: '#f1f5f9', // Text light
      });
    }

    // --- HTML Generator Functions ---

    /**
     * Generates HTML code based on a given prompt using an external API.
     * Displays the result, or an error if generation fails.
     */
    async function generateHTML() {
      const promptInput = document.getElementById('prompt');
      const prompt = promptInput.value.trim();
      const resultBox = document.getElementById('result');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const resultContent = document.getElementById('resultContent');
      const previewBox = document.getElementById('previewBox');
      const sourceBox = document.getElementById('sourceBox');

      if (!prompt) {
        return swalError('⚠️ Prompt tidak boleh kosong. Mohon masukkan deskripsi website yang Anda inginkan.');
      }

      resultBox.classList.remove('hidden');
      resultContent.classList.add('hidden');
      loadingIndicator.classList.remove('hidden');
      previewBox.classList.add('hidden');
      sourceBox.classList.add('hidden');

      try {
        const query = encodeURIComponent(prompt + " berikan respon hanya berupa kode html lengkap dari <!DOCTYPE html> hingga </html>. Jangan sertakan teks atau penjelasan lain.. ingat janagn contoh! langsung code yang kamu buat,, hasil tanpa sepatah katapun, hanya code yang kamu bikin");
        const res = await fetch(`https://api.yogik.id/ai/deepseek?prompt=${query}`);
        const data = await res.json();
        const htmlCode = data.result.match(/<!DOCTYPE html[\s\S]*<\/html>/i)?.[0];

        if (!htmlCode) {
          resultBox.classList.add('hidden');
          loadingIndicator.classList.add('hidden');
          return swalError('❌ Gagal menghasilkan HTML valid. Pastikan prompt Anda jelas.');
        }

        const rand = Math.floor(100000 + Math.random() * 900000);
        const filename = `fikxzmods-web-${rand}.html`;

        resultBox.dataset.filename = filename;
        sourceBox.value = htmlCode;

        loadingIndicator.classList.add('hidden');
        resultContent.classList.remove('hidden');
        resultContent.classList.add('animate-fade-in');
        swalSuccess('HTML berhasil dibuat!');

      } catch (error) {
        console.error('Error generating HTML:', error);
        loadingIndicator.classList.add('hidden');
        resultBox.classList.add('hidden');
        swalError('❌ Gagal menghubungi API atau terjadi kesalahan jaringan.');
      }
    }

    /**
     * Downloads the generated HTML file.
     * @param {string} name - The filename.
     * @param {string} content - The HTML content.
     */
    function downloadFile(name, content) {
      if (!content) {
        return swalError("Tidak ada konten untuk diunduh.");
      }
      const a = document.createElement('a');
      const blob = new Blob([content], { type: 'text/html' });
      a.href = URL.createObjectURL(blob);
      a.download = name;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(a.href);
      swalSuccess('File berhasil diunduh!');
    }

    /**
     * Toggles the visibility of the HTML preview iframe and loads content.
     * @param {string} code - The HTML code to preview.
     */
    function togglePreview(code) {
      const previewBox = document.getElementById('previewBox');
      const previewIframe = document.getElementById('previewIframe');
      const sourceBox = document.getElementById('sourceBox');

      if (!sourceBox.classList.contains('hidden')) {
        sourceBox.classList.add('hidden');
        sourceBox.classList.remove('animate-fade-in'); // Ensure clean state
      }

      if (previewBox.classList.contains('hidden')) {
        previewBox.classList.remove('hidden');
        previewBox.classList.add('animate-fade-in');
        previewIframe.contentWindow.document.open();
        previewIframe.contentWindow.document.write(code);
        previewIframe.contentWindow.document.close();
      } else {
        previewBox.classList.remove('animate-fade-in');
        previewBox.classList.add('animate-fade-out');
        setTimeout(() => {
          previewBox.classList.add('hidden');
          previewBox.classList.remove('animate-fade-out');
        }, 300);
      }
    }

    /**
     * Toggles the visibility of the source code textarea and displays content.
     * @param {string} code - The HTML source code.
     */
    function toggleSource(code) {
      const sourceBox = document.getElementById('sourceBox');
      const previewBox = document.getElementById('previewBox');

      if (!previewBox.classList.contains('hidden')) {
        previewBox.classList.add('hidden');
        previewBox.classList.remove('animate-fade-in'); // Ensure clean state
      }

      if (sourceBox.classList.contains('hidden')) {
        sourceBox.classList.remove('hidden');
        sourceBox.classList.add('animate-fade-in');
        sourceBox.value = code;
      } else {
        sourceBox.classList.remove('animate-fade-in');
        sourceBox.classList.add('animate-fade-out');
        setTimeout(() => {
          sourceBox.classList.add('hidden');
          sourceBox.classList.remove('animate-fade-out');
        }, 300);
      }
    }

    /**
     * Copies the given text to the clipboard.
     * @param {string} code - The text to copy.
     */
    function copyCode(code) {
      if (!code) {
        return swalError("Tidak ada kode untuk disalin.");
      }
      try {
        const textarea = document.createElement('textarea');
        textarea.value = code;
        textarea.style.position = 'fixed';
        textarea.style.top = '0';
        textarea.style.left = '0';
        textarea.style.width = '1px';
        textarea.style.height = '1px';
        textarea.style.padding = '0';
        textarea.style.border = 'none';
        textarea.style.outline = 'none';
        textarea.style.boxShadow = 'none';
        textarea.style.background = 'transparent';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        swalSuccess('Kode berhasil disalin ke clipboard!');
      } catch (err) {
        console.error('Failed to copy text: ', err);
        swalError('Gagal menyalin kode. Browser Anda mungkin tidak mendukung fitur ini.');
      }
    }

    // --- JS Encryptor Functions ---

    /**
     * Encodes a JavaScript file using a simple base64 obfuscation.
     */
    function encodeHard() {
      const fileInput = document.getElementById('fileInput');
      const file = fileInput.files[0];

      if (!file) {
        return swalError("Mohon pilih file .js terlebih dahulu untuk di-enkripsi.");
      }
      if (file.type !== 'application/javascript') {
        return swalError("File yang diunggah harus berformat .js (JavaScript).");
      }

      const loadingSwal = swalLoading('🔒 Sedang mengenkripsi file JS...');

      const reader = new FileReader();
      reader.onload = function (e) {
        const code = e.target.result;
        const base64 = btoa(unescape(encodeURIComponent(code)));
        const obfuscated = `/* Encoded Hard by FikXzMods Official */\n(function(){\n  const decode = Function("return decodeURIComponent(escape(atob('${base64}')))")();\n  eval(decode);\n})();`;
        lastEncodedCode = obfuscated;
        loadingSwal.close();
        swalSuccess("Enkripsi Keras berhasil! File siap diunduh.");
      };
      reader.onerror = function () {
        loadingSwal.close();
        swalError("Gagal membaca file.");
      };
      reader.readAsText(file);
    }

    /**
     * Downloads the last encoded JavaScript output.
     */
    function downloadOutput() {
      if (!lastEncodedCode) {
        return swalError("Belum ada hasil enkripsi. Mohon enkripsi file terlebih dahulu.");
      }
      const blob = new Blob([lastEncodedCode], { type: 'text/javascript' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'fikxzmods-encoded.js';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(link.href);
      swalSuccess("File berhasil diunduh!");
    }

    // --- HTML Deploy Functions ---

    /**
     * Deploys an HTML project to Vercel (placeholder, real implementation needs backend).
     */
    async function deployHTML() {
      const projectNameInput = document.getElementById('projectName');
      const htmlFileInput = document.getElementById('htmlFile');
      const deployActions = document.getElementById('deployActions');

      const name = projectNameInput.value.toLowerCase().replace(/[^a-z0-9-_]/g, '');
      const file = htmlFileInput.files[0];

      if (!file || !name) {
        return swalError('❌ Lengkapi Nama Proyek dan pilih file HTML!');
      }
      if (file.type !== 'text/html') {
        return swalError('File yang diunggah harus berformat .html.');
      }

      const loadingSwal = swalLoading('🚀 Sedang mendeploy proyek Anda...');

      try {
        const buffer = await file.arrayBuffer();
        const base64 = btoa(String.fromCharCode(...new Uint8Array(buffer)));

        // --- Vercel API Calls (Placeholder - requires actual Vercel integration and backend for security) ---
        await fetch('https://api.vercel.com/v9/projects', {
          method: 'POST',
          headers: { Authorization: `Bearer ${vercelToken}`, 'Content-Type': 'application/json' },
          body: JSON.stringify({ name })
        }).then(res => {
            if (!res.ok && res.status !== 409) { // 409 Conflict means project already exists, which is fine
                console.warn(`Vercel project creation warning (status: ${res.status}):`, res);
            }
            return res.json();
        }).catch(err => console.warn("Project creation (might be existing) error:", err));


        const deployRes = await fetch('https://api.vercel.com/v13/deployments', {
          method: 'POST',
          headers: { Authorization: `Bearer ${vercelToken}`, 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: name,
            project: name,
            target: 'production',
            files: [{ file: 'index.html', data: base64, encoding: 'base64' }]
          })
        });

        const data = await deployRes.json();

        if (!deployRes.ok) {
          throw new Error(data.error?.message || 'Gagal mendeploy proyek.');
        }

        lastDeployedURL = `https://${data.url}`;
        deployActions.classList.remove('hidden');
        deployActions.classList.add('animate-fade-in');
        loadingSwal.close();
        swalSuccess(`✅ Proyek '${name}' berhasil di-deploy!`);

      } catch (error) {
        console.error('Error deploying HTML:', error);
        loadingSwal.close();
        swalError(`❌ Gagal mendeploy proyek: ${error.message || 'Terjadi kesalahan.'}`);
        deployActions.classList.add('hidden');
      }
    }

    /**
     * Copies the last deployed URL to the clipboard.
     */
    function copyLink() {
      if (!lastDeployedURL) {
        return swalError("Belum ada URL untuk disalin. Mohon deploy proyek terlebih dahulu.");
      }
      try {
        const textarea = document.createElement('textarea');
        textarea.value = lastDeployedURL;
        textarea.style.position = 'fixed';
        textarea.style.top = '0';
        textarea.style.left = '0';
        textarea.style.width = '1px';
        textarea.style.height = '1px';
        textarea.style.padding = '0';
        textarea.style.border = 'none';
        textarea.style.outline = 'none';
        textarea.style.boxShadow = 'none';
        textarea.style.background = 'transparent';
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        swalSuccess('Tautan berhasil disalin ke clipboard!');
      } catch (err) {
        console.error('Failed to copy link: ', err);
        swalError('Gagal menyalin tautan. Peramban Anda mungkin tidak mendukung fitur ini.');
      }
    }

    /**
     * Opens the last deployed URL in a new tab.
     */
    function viewSite() {
      if (!lastDeployedURL) {
        return swalError("Belum ada situs untuk dilihat. Mohon deploy proyek terlebih dahulu.");
      }
      window.open(lastDeployedURL, '_blank');
    }

    /**
     * Lists all projects from Vercel (placeholder, real implementation needs backend).
     */
    async function listProjects() {
      const projectListDiv = document.getElementById('projectList');
      const projectListLoading = document.getElementById('projectListLoading');

      projectListDiv.innerHTML = '';
      projectListDiv.classList.add('hidden');
      projectListLoading.classList.remove('hidden');
      projectListDiv.classList.remove('animate-fade-in'); // Ensure animation can re-trigger

      try {
        const res = await fetch('https://api.vercel.com/v9/projects', {
          headers: { Authorization: `Bearer ${vercelToken}` }
        });
        const data = await res.json();

        if (!res.ok) {
          throw new Error(data.error?.message || 'Gagal mengambil daftar proyek.');
        }

        if (data.projects && data.projects.length > 0) {
          const projectItems = data.projects.map(p =>
            `<div class="flex items-center space-x-2 p-3 rounded-lg bg-bg-dark border border-border-dark shadow-sm hover:border-accent-blue transition-colors duration-200">
              <i class="ph ph-folder-open text-accent-blue text-lg"></i>
              <span class="font-medium text-text-light truncate">${p.name}</span>
              <a class='underline text-accent-blue hover:text-accent-blue-hover transition-colors duration-200 ml-auto flex items-center' href='https://${p.name}.vercel.app' target='_blank' rel="noopener noreferrer">
                <span class="truncate max-w-[120px] sm:max-w-none">${p.name}.vercel.app</span> <i class="ph ph-arrow-square-out text-base ml-1"></i>
              </a>
            </div>`
          ).join('');
          projectListDiv.innerHTML = projectItems;
        } else {
          projectListDiv.innerHTML = '<p class="text-muted-text text-center py-4">Tidak ada proyek yang ditemukan.</p>';
        }
        projectListLoading.classList.add('hidden');
        projectListDiv.classList.remove('hidden');
        projectListDiv.classList.add('animate-fade-in'); // Apply fade-in after content is loaded
      } catch (error) {
        console.error('Error listing projects:', error);
        projectListLoading.classList.add('hidden');
        projectListDiv.classList.remove('hidden');
        projectListDiv.innerHTML = `<p class="text-danger-red text-center py-4">❌ Gagal memuat proyek: ${error.message || 'Terjadi kesalahan.'}</p>`;
      }
    }

    /**
     * Deletes a Vercel project (restricted to admin IP for "FikXzMods").
     */
    async function deleteProject() {
      const deleteNameInput = document.getElementById('deleteName');
      const messageDiv = document.getElementById('message');
      const projectNameToDelete = deleteNameInput.value.trim();

      if (!projectNameToDelete) {
        return swalError('Mohon masukkan Nama Proyek yang ingin dihapus.');
      }

      messageDiv.classList.add('hidden');

      const loadingSwal = swalLoading(`🗑️ Sedang menghapus proyek '${projectNameToDelete}'...`);

      try {
        const ipRes = await fetch('https://api64.ipify.org?format=json');
        const ipData = await ipRes.json();
        const currentIP = ipData.ip;

        if (currentIP !== adminIP) {
          loadingSwal.close();
          swalError('❌ Akses Ditolak: Hanya FikXzMods yang bisa menghapus proyek.');
          messageDiv.className = 'text-sm text-center mt-4 p-3 rounded-lg bg-danger-red/20 border border-danger-red text-danger-red animate-fade-in';
          messageDiv.innerText = '❌ Akses Ditolak: Hanya FikXzMods yang bisa menghapus proyek.';
          messageDiv.classList.remove('hidden');
          return;
        }

        const res = await fetch(`https://api.vercel.com/v9/projects/${projectNameToDelete}`, {
          method: 'DELETE',
          headers: { Authorization: `Bearer ${vercelToken}` }
        });

        loadingSwal.close();

        if (res.status === 204) {
          swalSuccess(`✅ Proyek '${projectNameToDelete}' berhasil dihapus.`);
          messageDiv.className = 'text-sm text-center mt-4 p-3 rounded-lg bg-success-green/20 border border-success-green text-success-green animate-fade-in';
          messageDiv.innerText = `✅ Proyek '${projectNameToDelete}' berhasil dihapus.`;
        } else {
          const errorData = await res.json();
          const errorMessage = errorData.error?.message || `Gagal hapus: Status ${res.status}`;
          swalError(`❌ ${errorMessage}`);
          messageDiv.className = 'text-sm text-center mt-4 p-3 rounded-lg bg-danger-red/20 border border-danger-red text-danger-red animate-fade-in';
          messageDiv.innerText = `❌ Gagal hapus proyek: ${errorMessage}`;
        }
        messageDiv.classList.remove('hidden');

      } catch (error) {
        console.error('Error deleting project:', error);
        loadingSwal.close();
        swalError(`❌ Terjadi kesalahan saat menghapus proyek: ${error.message || 'Gagal menghubungi server.'}`);
        messageDiv.className = 'text-sm text-center mt-4 p-3 rounded-lg bg-danger-red/20 border border-danger-red text-danger-red animate-fade-in';
        messageDiv.innerText = `❌ Terjadi kesalahan saat menghapus proyek: ${error.message || 'Gagal menghubungi server.'}`;
        messageDiv.classList.remove('hidden');
      }
    }

    // Initialize the first section on load
    document.addEventListener('DOMContentLoaded', () => {
      showSection('generate');
      const sidebar = document.getElementById('sidebar');
      if (window.innerWidth >= 768) {
        sidebar.classList.remove('translate-x-full');
        sidebar.classList.add('translate-x-0', 'md:static', 'md:flex-row', 'md:p-0', 'md:pr-6', 'md:border-none', 'md:shadow-none', 'md:bg-transparent');
      }
    });

    // Handle window resize for sidebar behavior on desktop/mobile
    window.addEventListener('resize', () => {
      const sidebar = document.getElementById('sidebar');
      if (window.innerWidth >= 768) {
        sidebar.classList.remove('translate-x-full');
        sidebar.classList.add('translate-x-0', 'md:static', 'md:flex-row', 'md:p-0', 'md:pr-6', 'md:border-none', 'md:shadow-none', 'md:bg-transparent');
      } else {
        sidebar.classList.remove('translate-x-0', 'md:static', 'md:flex-row', 'md:p-0', 'md:pr-6', 'md:border-none', 'md:shadow-none', 'md:bg-transparent');
        sidebar.classList.add('translate-x-full');
      }
    });

  </script>
</body>
</html>

